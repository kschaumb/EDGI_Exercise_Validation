---
title: EDGI Exercise Validation Paper Results
author: Katherine Schaumberg
output:
  bookdown::html_document2: default
editor_options: 
  markdown: 
    wrap: 72
---

```{r, setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE,  warning = FALSE)
library(expss)
library(bookdown)
library(dplyr)
library(haven)
library(sjmisc)
library(rmarkdown)
library(knitr)
library(psych)
library(ggplot2)
library(ggrepel)
library(wesanderson)
library(tidyr)
library(caret)
load('../data/EDGI_exercise_cleaned.RData') 

exercisers <- EDGI_exercise_cleaned |> 
  filter(ED100k_exercise_icb > 0)
regular_exercisers <- EDGI_exercise_cleaned |> 
  filter(ED100k_exercise_icb == 2)
compulsive_exercisers <- EDGI_exercise_cleaned |> 
  filter(ED100k_ex_compulsive >0)
regular_compulsive_exercisers <- EDGI_exercise_cleaned |> 
  filter (ED100k_ex_compulsive_strict == 1)

```

# Preliminary Aim - Develop a scoring algorithm

The first aim of this paper is to develop a scoring algorithm for a
ED100k exercise items in an ED sample based on theoretical literature
and available ED100k items which captures and defines rates of:

1\. Compulsive Exercise

-   Ever and Regular Compulsive Exercise

-   Current Compulsive Exercise

2\. Exercise Addiction

3\. Excessive Exercise

4\. Compensatory Exercise

5\. Maladaptive Exercise (Broad)

## Scoring

The ED100k included 12 questions regarding maladaptive exercise. The
first question which all participants were asked, inquires as to whether
individuals ever exercised to intentionally control weight and shape
(Q1). Only those who endorsed EVER Exercising to intentionally control
weight or shape were asked to respond to two additional questions which
asked about exercise in more detail, including two questions (Q2, Q3)
about whether individuals ever felt compelled to exercise and whether
they felt uneasy or distressed if unable to exercise. In a third step,
those who reported ever exercising to intentionally control weight and
shape and answered 'Yes' to either Q2 or Q3 were additionally asked
three questions (Q4-Q6) about whether exercise interfered with life
activities or diet, along with questions regarding the onset (Q7),
duration (Q8), and frequency (Q9) of their compulsive exercise, along
with whether they engaged in the behavior currently (Q10) and the last
age at which they engaged in the behavior (Q11). In a separate section,
all participants were asked whether they had 'exercised excessively'
specifically to *compensate* for episodes of binge eating or overeating
(Q12). During recoding, those (n =
`r sum(EDGI_exercise_cleaned$ED100k_ex_any == 0)`) who reported no to
Q1 - exercise to control shape and weight, were marked as '0' for
follow-up questions. Those who reported that they had engaged in
exercise to for weight and shape control but 'No' to both Q2 & Q3 (n =
`r sum(exercisers$ED100k_ex_compulsive == 0, na.rm = TRUE)`) were marked
as '0' for Q4-Q11.

Scoring algorithms for each subconstruct are presented in Table 1.

+---------------------+----------------------+---------------------+
| Construct           | Criteria             | Nested Within       |
+=====================+======================+=====================+
|                     |                      |                     |
+---------------------+----------------------+---------------------+
| Exercise for Weight |                      |                     |
| Control             |                      |                     |
+---------------------+----------------------+---------------------+
| Regular Exercise    |                      |                     |
| for Weight Control  |                      |                     |
+---------------------+----------------------+---------------------+
| Compulsive Exercsie | Exercise for Weight  | Exercise for Weight |
|                     | Control (Q1) = 'A    | Control             |
|                     | few times, but never |                     |
|                     | became a habit' OR   |                     |
|                     | More Often'          |                     |
|                     |                      |                     |
|                     | (Ever felt compelled |                     |
|                     | to exercise == 'YES' |                     |
|                     | OR Ever uneasy or    |                     |
|                     | distressed when      |                     |
|                     | unable to exercise   |                     |
|                     | == 'YES')            |                     |
+---------------------+----------------------+---------------------+
| Regular Compulsive  | Exercise for Weight  | Exercise for Weight |
| Exercise            | Control (Q1) ==      | Control             |
|                     | 'More often'         |                     |
|                     |                      | Regular Exercise    |
|                     | (Ever felt compelled | for Weight Control  |
|                     | to exercise OR Ever  |                     |
|                     | uneasy or distressed | Compulsive Exercise |
|                     | when unable to       |                     |
|                     | exercise)            |                     |
+---------------------+----------------------+---------------------+
| Addictive Exercise  | > Regular Compulsive | Exercise for Weight |
|                     | > Exercise lasting   | Control             |
|                     | > at Least 3 month   |                     |
|                     |                      | Regular Exercise    |
|                     | > 1 or more of the   | for Weight Control  |
|                     | > following: caused  |                     |
|                     | > them to change     | Compulsive Exercise |
|                     | > eating habits      |                     |
|                     |                      | Regular Compulsive  |
|                     | -decline             | Exercise            |
|                     | opportunities to be  |                     |
|                     | with friends         |                     |
|                     |                      |                     |
|                     | -exercised despite   |                     |
|                     | illness or injury    |                     |
+---------------------+----------------------+---------------------+
| Excessive Exercise  | > Compulsive         | Compulsive Exercise |
|                     | > Exercise           |                     |
|                     |                      |                     |
|                     | > Duration \>= 1     |                     |
|                     | > month              |                     |
|                     |                      |                     |
|                     | > Frequency = 'Every |                     |
|                     | > Day' or 'Nearly    |                     |
|                     | > Every Day'         |                     |
+---------------------+----------------------+---------------------+
| Compensatory        |                      | None                |
| Exercise            |                      |                     |
+---------------------+----------------------+---------------------+
| Maladaptive         | Compulsive Exercise  | None                |
| Exericse            | == 'Yes' OR          |                     |
|                     | Compensatory         |                     |
|                     | Exercise == 'Yes'    |                     |
+---------------------+----------------------+---------------------+

: Table 1. Algorithm defining exercise-related constructs in the ED100k

# Aim 1. Evaluate patterns of response across multiple exercise constructs, to identify the degree to which these constructs overlap in membership or capture distinct groups

We hypothesize that those indicating that they have \'exercise
excessively\' more often in the initial screening item will also be
likely to meet criteria for compulsive exercise, exercise addiction, and
excessive exercise (high sensitivity), and moderately likely to meet
criteria for compensatory exercise (moderate sensitivity; high negative
predictive value).

Figure 1 presents the proportion of the full sample along with
subsamples meeting criteria for each (sub)construct

![Figure 1. Heatmap with percentage of (sub)samples (horizontal axis)
meeting criteria for each (sub)construct (vertical
axis).](ex_heatmap.png){#heatmap}

## Sensitivity of Q1 - Excessive Exercise 

Overall, there was high convergent validity for Q1 with Q2-Q6.
Specifically, individuals eating disorders who endorse using exercise to
intentionally control weight 'more often' are indeed highly likely to
engage in this behavior for a substantive period of time (xx% of those
reporting exercise to intentionally control weight 'more often' reported
a duration of compulsive exercise \> 3 months; a time period of
equivalent to diagnostic levels of other intentional weight control
behaviors), and to report symptoms consistent with a definition of both
compulsive and addictive exercise. Regarding the sensitivity of Q1 to
detect compulsive, addictive, and excessive exericse, xxxx (add
confusion matrix statistics here). Overall, the vast majority of
individuals with eating disorders who reporting regular exercise for
weight loss to control weight and shape report that this exercise was
compulsive, and that they also experienced life interfering sequellae of
this behavior. Regarding specific addictive exercise symptoms, the modal
number of exercise interference items was all 3. Findings suggest high
sensitivity of Q1 to additional follow-up questions regarding addictive
and compulsive exercise, with slightly less sensitivity to excessive
exercise (high frequency)

With regards to compensatory exercise, about
(`r frq(regular_exercisers$be_icb___5)[[1]]$valid.prc[[2]]`)% of
individuals who reported maladpative exercising 'more often' in Q1 also
reported a history of compensatory exercise (sensitivity = ). Among the
group reporting compensatory exercise, xx% reported exercising for
weight loss at all in Q1, (NPV = ), and xx% reported exercising for
weight loss 'more often' in Q1 (NPV = ). In sum, compensatory exercise
was common, but somewhat less prevalent than other maladaptive exercise
behaviors, and there was high sensitivity to detect compensatory
exercise for those who reported any exercise for weight control in Q1.

# **Aim 2. Evaluate Convergent and Discriminant Validity between history of *maladaptive* and c*ompulsive* exercise and: current compulsive exercise, perfectionism, and OCD sympotms** 

H2a: Individuals who do not report *any* *history* of maladaptive and
compulsive exercise will not report current compulsive exercise (high
negative predictive value). *\>90% negative predictive value of history
to 1. Current compulsive exercise on the EDEQ, 2. Current compulsive
exercise on the CET*

H2b: Comparing those with and without history of compulsive exercise,
those with history of compulsive exercise will report higher current
compulsive exercise symptoms (all CET subscales) than those without.
Those reporting current compulsive exercise will report the highest CET
scores. *ANOVA comparing those with no compulsive exercise, history of
compulsive exercise only, and current compulsive exercise on current
CET, p \< .05 for all subscales and global[,]{.underline} and
calculation of Cohen\'s d effect sizes.*

## Current Exercise

```{r}
# Insert ggplots here showing association between current exercise (ED100k), CET total and subscale scores *mean + SD, CET clinical cutoff, and EDEQ item

Current_Exercise <- EDGI_exercise_cleaned |> 
  select(record_id, cet_total_weighted_sum, cet_mood, cet_enjoy, cet_avoid, cet_rigid, cet_wtcontrol, cet_clinical, edeq_ex_driven_freq_28, ED100k_exercise_current)  |>  filter(!is.na(ED100k_exercise_current)) |> 
  mutate(cet_total_std = scale(cet_total_weighted_sum),
         cet_mood_std = scale(cet_mood),
         cet_enjoy_std = scale(cet_enjoy), 
         cet_avoid_std = scale (cet_avoid), 
         cet_rigid_std = scale (cet_rigid),
         cet_wtcontrol_std = scale(cet_wtcontrol))

  # standardize outcome variables
Current_Exercise <- Current_Exercise |> pivot_longer(cols = c(cet_total_std:cet_wtcontrol_std), names_to = 'variable', values_to = 'val') # pivot longer with current exercise as one column, variable name as second column, value as third
  # rename current maladaptive exercise 
  

median_stds <- Current_Exercise |> 
  group_by (ED100k_exercise_current, variable) |> 
  summarize (med_val = median(val, na.rm = TRUE))

cet_total_plot <- ggplot(Current_Exercise, aes(x = as.factor(ED100k_exercise_current), y = val, color = as.factor(ED100k_exercise_current))) +
  facet_wrap(~variable)+
  geom_jitter(size = 0.3) +
  geom_boxplot(alpha = 0.5, color= 'black') +
  scale_x_discrete(labels = c('No Hx', 'Hx only', 'Current')) +
  labs(title = 'Median CET standardized scores based on Driven Exercise History (ED100k)', x = 'Current Driven Exercise [ED100k]', y = 'CET Standardized Score') + 
  theme(legend.position = 'none') +
  geom_text(data = median_stds, aes(x = as.factor(ED100k_exercise_current), y = med_val + 0.3, label = round(med_val, 1)), size = 3, color = 'black', fontface ='bold')


cet_total_plot

```

## Proportion meeting CET Clinical Cutoff based on Maladaptive Exercise History

```{r}

ct3 <- table(EDGI_exercise_cleaned$ED100k_exercise_current, EDGI_exercise_cleaned$cet_clinical)
ex_current_cet <- prop.table (ct3, 1)
ex_current_cet <- as.data.frame(ex_current_cet) |> 
 rename(`Current Driven Exercise [ED100k]` = Var1) |> 
 rename(`CET Clinical Met` = Var2)   |> 
 filter (`CET Clinical Met` == 1)

ggplot(ex_current_cet, aes( x = `Current Driven Exercise [ED100k]`, y = Freq*100, fill = `Current Driven Exercise [ED100k]` )) + 
  geom_col()+
  labs(title = 'ED100k Drive Exercise vs Clinical CET Cutoff', x = 'Driven Exercise Endorsed [ED100k]', y = 'Percent Meeting CET Cutoff') + 
  scale_x_discrete(labels = c('No History', 'History, Not Current', 'Current')) +
  theme(legend.position = 'none') +
  geom_text(aes(x  = `Current Driven Exercise [ED100k]`, y = (Freq*100)-3, label = paste0(round(Freq*100,2),'%'), size = 3))
# change colour
```

### Sensitivity and Specificity of Current Driven Exercise on ED100k for CET Clinical

```{r}
EDGI_exercise_cleaned$ED100k_exercise_current_d <- as.factor(if_else(EDGI_exercise_cleaned$ED100k_exercise_current == 2, 1, 0))

EDGI_exercise_cleaned$cet_clinical <- as.factor(EDGI_exercise_cleaned$cet_clinical)

confusionMatrix(EDGI_exercise_cleaned$ED100k_exercise_current_d, EDGI_exercise_cleaned$cet_clinical, positive = '1') #confusion matrix with ED100k exercise current as prediction and CET clinical as actual

```

## Number of Days in the Past 28 reported Driven Exercise based on Driven Exercise History

```{r}

mean_edeq_ex <- EDGI_exercise_cleaned|> 
  group_by (ED100k_exercise_current) |> 
  filter(!is.na(ED100k_exercise_current)) |> 
  summarize (mean_edeq_ex = mean(edeq_ex_driven_freq_28, na.rm = TRUE))

ggplot(mean_edeq_ex, aes( x = as.factor(ED100k_exercise_current), y = mean_edeq_ex))  +
  geom_point()+
  geom_boxplot(data = EDGI_exercise_cleaned, aes( x = as.factor(ED100k_exercise_current), y = edeq_ex_driven_freq_28, fill = as.factor(ED100k_exercise_current))) +
  labs(title = 'ED100k Drive Exercise vs EDEQ Driven Exercise Frequency (Past 28 days)', x = 'Driven Exercise Endorsed [ED100k]', y = 'Number of Driven Exercise Episodes in Past 28 days [EDEQ]') + 
  scale_x_discrete(labels = c('No History', 'History, Not Current', 'Current')) +
  theme(legend.position = 'none') +
  geom_text(data = mean_edeq_ex, aes(x  = ED100k_exercise_current+1.2, y = mean_edeq_ex+3, label = paste0('M =', round(mean_edeq_ex,2)), size = 3))
```

## Perfectionism and OCD Symptoms

H2c: Within diagnostic groups - those with vs. without history of
maladaptive exercise will report higher Frost MPS and OCD symptoms.
*t-tests within diagnostic groups comparing frost MPS and OCI-R/OCI-12
subscale scores, p \< 0.05, and calculation of Cohen\'s d effect sizes*

H2d: Associations with the MPS and OCD measure will be weaker than with
the CET. *Interpret patterns of ES*

t-tests within diagnostic groups comparing frost MPS and OCI-R/OCI-12
subscale scores, p \< 0.05[, and calculation of Cohen\'s d effect
sizes]{.underline}

# Aim 3. Demonstrate Prevalence of Maladaptive (Broad), Compulsive, Addictive, Excessive, and Compensatory Exercise across Diagnostic Groups

H3a. Maladaptive exercise, compulsive exercise, and exercise addiction
will be a common symptom across diagnoses. More common in AN and BN than
BED. *Rates of maladaptive exercise, compulsive exercise, excessive
exercise, and exercise addiction will all be \> 50% in AN and BN
presentations; \> 20% in BED*

H3b. Compensatory exercise will be more common among those with AN mixed
and BN as compared to AN only . *Multinomial* *logistic regression with
AN group as reference -- BN groups will not differ but BED will? (or
some other way to use dummy coding to compare groups )*

```{r, results = 'hide'}
# Below makes the 5 case status diagnosis groups
as.data.frame(table(EDGI_exercise_cleaned[c('an_case', 'bn_case', 'bed_case')])) |>
  mutate (prop = round(Freq/sum(Freq)*100, 2)) |> 
  filter (Freq != 0) 
#Make case heirarcy and recode restrictive and binge spectrum mixed cases
EDGI_exercise_cleaned <- EDGI_exercise_cleaned |> 
  mutate (case_status = case_when(an_case == 1 & bn_case == 0 & bed_case == 0 ~ 'AN',
                                   an_case == 0 & bn_case == 1 & bed_case == 0 ~ 'BN',
                                   an_case == 0 & bn_case == 0 & bed_case == 1 ~ 'BED', 
                                   an_case == 1 & (bn_case == 1 | bed_case == 1) ~ 'AN Mixed',
                                   an_case == 0 & bn_case ==1 & bed_case ==1 ~ 'BN-BED Mixed' )) |> 
  mutate (case_heirarchy = case_when (an_case == 1 ~ 'AN', 
                                      bn_case == 1 ~ 'BN', 
                                      bed_case == 1 ~ 'BED'))
```

```{r}
ct <- table(EDGI_exercise_cleaned$case_status, EDGI_exercise_cleaned$ED100k_ex_compulsive)

dx_row_percents <- prop.table (ct, 1)

dx_row_percents <- as.data.frame(dx_row_percents) |> 
 rename(`Diagnosis Group` = Var1) |> 
 rename(`History of Any Compulsive Exercise` =Var2) 

ggplot(dx_row_percents, aes( x = `History of Any Compulsive Exercise`, y = Freq*100, fill = `Diagnosis Group` )) + 
  geom_col()+
  facet_wrap (~ `Diagnosis Group`) +
  labs(title = 'Percentages by Diagnosis Group and History of Any Compulsive Exercise', x = 'History of Any Compulsive Exercise', y = 'Percentage (within Diagnosis Group)') + 
  scale_x_discrete(labels = c('No', 'Yes')) +
    theme(legend.position = 'none') +
    geom_text(aes(x  = `History of Any Compulsive Exercise`, y = (Freq*100)-5, label = paste0(round(Freq*100,2),'%'), size = 3))

```

History of Compulsive Exercise was reported most frequently in the AN,
AN-Mixed Diagnosis, and BN groups, around 60% in each of these
diagnostic groups reporting history of regular engagment. Compulsive
exercise was also reported in half of those with BN-BED (50%) and a
portion (20%) of those with BED.

```{r}
ct <- table(EDGI_exercise_cleaned$case_status, EDGI_exercise_cleaned$ED100k_ex_compulsive_strict_3mo)

dx_row_percents <- prop.table (ct, 1)

dx_row_percents <- as.data.frame(dx_row_percents) |> 
 rename(`Diagnosis Group` = Var1) |> 
 rename(`History of Regular Compulsive Exercise` =Var2) 

ggplot(dx_row_percents, aes( x = `History of Regular Compulsive Exercise`, y = Freq*100, fill = `Diagnosis Group` )) + 
  geom_col()+
  facet_wrap (~ `Diagnosis Group`) +
  labs(title = 'Percentages by Diagnosis Group and History of Regular Compulsive Exercise', x = 'History of Regular Compulsive Exercise', y = 'Percentage (within Diagnosis Group)') + 
  scale_x_discrete(labels = c('No', 'Yes')) +
    theme(legend.position = 'none') +
    geom_text(aes(x  = `History of Regular Compulsive Exercise`, y = (Freq*100)-5, label = paste0(round(Freq*100,2),'%'), size = 3))

```

```{r}
ct <- table(EDGI_exercise_cleaned$case_status, EDGI_exercise_cleaned$ED100k_ex_addictive)

dx_row_percents <- prop.table (ct, 1)

dx_row_percents <- as.data.frame(dx_row_percents) |> 
 rename(`Diagnosis Group` = Var1) |> 
 rename(`History of Exercise Addiction` =Var2) 

ggplot(dx_row_percents, aes( x = `History of Exercise Addiction`, y = Freq*100, fill = `Diagnosis Group` )) + 
  geom_col()+
  facet_wrap (~ `Diagnosis Group`) +
  labs(title = 'Percentages by Diagnosis Group and History of Exercise Addiction', x = 'History of Exercise Addiction', y = 'Percentage (within Diagnosis Group)') + 
  scale_x_discrete(labels = c('No', 'Yes')) +
    theme(legend.position = 'none') +
    geom_text(aes(x  = `History of Exercise Addiction`, y = (Freq*100)-5, label = paste0(round(Freq*100,2),'%'), size = 3))

```

```{r}
ct <- table(EDGI_exercise_cleaned$case_status, EDGI_exercise_cleaned$ED100k_ex_excessive)

ct_tab <- as.data.frame(ct) %>% 
  pivot_wider(names_from = Var2, values_from = Freq) 

dx_row_percents <- prop.table (ct, 1)

dx_row_percents <- as.data.frame(dx_row_percents) |> 
 rename(`Diagnosis Group` = Var1) |> 
 rename(`History of Excessive Exercise` =Var2) 

ggplot(dx_row_percents, aes( x = `History of Excessive Exercise`, y = Freq*100, fill = `Diagnosis Group` )) + 
  geom_col()+
  facet_wrap (~ `Diagnosis Group`) +
  labs(title = 'Percentages by Diagnosis Group and History of Excessive Exercise', x = 'History of Excessive Exercise', y = 'Percentage (within Diagnosis Group)') + 
  scale_x_discrete(labels = c('No', 'Yes')) +
    theme(legend.position = 'none') +
    geom_text(aes(x  = `History of Excessive Exercise`, y = (Freq*100)-5, label = paste0(round(Freq*100,2),'%'), size = 3))

```

```{r}
ct <- table(EDGI_exercise_cleaned$case_status, EDGI_exercise_cleaned$ED100k_ex_compensatory)

ct_tab <- as.data.frame(ct) %>% 
  pivot_wider(names_from = Var2, values_from = Freq) 

dx_row_percents <- prop.table (ct, 1)

dx_row_percents <- as.data.frame(dx_row_percents) |> 
 rename(`Diagnosis Group` = Var1) |> 
 rename(`History of Compensatory Exercise` =Var2) 

ggplot(dx_row_percents, aes( x = `History of Compensatory Exercise`, y = Freq*100, fill = `Diagnosis Group` )) + 
  geom_col()+
  facet_wrap (~ `Diagnosis Group`) +
  labs(title = 'Percentages by Diagnosis Group and History of Compensatory Exercise', x = 'History of Compensatory Exercise', y = 'Percentage (within Diagnosis Group)') + 
  scale_x_discrete(labels = c('No', 'Yes')) +
    theme(legend.position = 'none') +
    geom_text(aes(x  = `History of Compensatory Exercise`, y = (Freq*100)-5, label = paste0(round(Freq*100,2),'%'), size = 3))

```
