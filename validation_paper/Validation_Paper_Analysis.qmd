---
title: EDGI Exercise Validation Paper Results
author: Katherine Schaumberg
format: html

---

```{r, setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE,  warning = FALSE)
library(expss)
library(bookdown)
library(dplyr)
library(haven)
library(sjmisc)
library(rmarkdown)
library(knitr)
library(psych)
library(ggplot2)
library(ggrepel)
library(wesanderson)
library(tidyr)
library(caret)
load('../data/EDGI_exercise_cleaned.RData') 

exercisers <- EDGI_exercise_cleaned |> 
  filter(ED100k_exercise_icb > 0)
regular_exercisers <- EDGI_exercise_cleaned |> 
  filter(ED100k_exercise_icb == 2)
compulsive_exercisers <- EDGI_exercise_cleaned |> 
  filter(ED100k_ex_compulsive >0)
regular_compulsive_exercisers <- EDGI_exercise_cleaned |> 
  filter (ED100k_ex_compulsive_strict == 1)

```

# Preliminary Aim - Develop a scoring algorithm

The first aim of this paper is to develop a scoring algorithm for a
ED100k exercise items in an ED sample based on theoretical literature
and available ED100k items which captures and defines rates of:

1\. Compulsive Exercise

-   Ever and Regular Compulsive Exercise

-   Current Compulsive Exercise

2\. Exercise Addiction

3\. Excessive Exercise

4\. Compensatory Exercise

5\. Maladaptive Exercise (Broad)

## Scoring

The ED100k included 12 questions assessing maladaptive exercise. The first question, which all participants were asked, inquires as to whether individuals ever exercised to intentionally control weight and shape (Q1). Only those who endorsed EVER Exercising to intentionally control weight or shape were asked to respond to two additional questions which asked about exercise in more detail, including two questions (Q2, Q3) about whether individuals ever felt compelled to exercise and whether they felt uneasy or distressed if unable to exercise. In a third step, those who reported ever exercising to intentionally control weight and shape and answered 'Yes' to either Q2 or Q3 were additionally asked three questions (Q4-Q6) about whether exercise interfered with life activities or diet, along with questions regarding the onset (Q7), duration (Q8), and frequency (Q9) of their compulsive exercise, along with whether they engaged in the behavior currently (Q10) and the last age at which they engaged in the behavior (Q11). In a separate section, all participants were asked whether they had 'exercised excessively' specifically to *compensate* for episodes of binge eating or overeating (Q12). During recoding, those (n = `r sum(EDGI_exercise_cleaned$ED100k_ex_any == 0)`) who reported no to Q1 - exercise to control shape and weight, were marked as '0' for follow-up questions. Those who reported that they had engaged in exercise to for weight and shape control but 'No' to both Q2 & Q3 (n = `r sum(exercisers$ED100k_ex_compulsive == 0, na.rm = TRUE)`) were marked as '0' for Q4-Q11.

Scoring algorithms for each subconstruct are presented in Table 1.

+-------------------+-------------------+-------------------+
| Construct         | Criteria          | Nested Within     |
+===================+===================+===================+
| Exercise for      | To control weight | NA                |
| Weight Control    | and shape --      |                   |
|                   | participant       |                   |
|                   | endorses that     |                   |
|                   | they have         |                   |
|                   | exercised         |                   |
|                   | excessively (e.g. |                   |
|                   | felt compelled to |                   |
|                   | exercise, felt    |                   |
|                   | uneasy or         |                   |
|                   | distressed if     |                   |
|                   | unable to         |                   |
|                   | exercise) = 'a    |                   |
|                   | few times, but it |                   |
|                   | never became a    |                   |
|                   | habit' or more    |                   |
+-------------------+-------------------+-------------------+
| Regular Exercise  | To control weight | NA                |
| for Weight        | and shape --      |                   |
| Control           | participant       |                   |
|                   | endorses that     |                   |
|                   | they have         |                   |
|                   | exercised         |                   |
|                   | excessivelyÂ       |                   |
|                   | (e.g. felt        |                   |
|                   | compelled to      |                   |
|                   | exercise, felt    |                   |
|                   | uneasy or         |                   |
|                   | distressed if     |                   |
|                   | unable to         |                   |
|                   | exercise) = 'more |                   |
|                   | often'            |                   |
+-------------------+-------------------+-------------------+
| Compulsive        | Exercise for      | Exercise for      |
| Exercise          | Weight Control +  | Weight Control    |
|                   |                   |                   |
|                   | Ever felt         |                   |
|                   | compelled to      |                   |
|                   | exercise == 'YES' |                   |
|                   | OR Ever uneasy or |                   |
|                   | distressed when   |                   |
|                   | unable to         |                   |
|                   | exercise == 'YES' |                   |
+-------------------+-------------------+-------------------+
| Regular           | Regular Exercise  | Exercise for      |
| Compulsive        | for Weight        | Weight Control    |
| Exercise          | Control           |                   |
|                   |                   | Regular Exercise  |
|                   | Ever felt         | for Weight        |
|                   | compelled to      | Control           |
|                   | exercise == 'YES' |                   |
|                   | OR Ever uneasy or | Compulsive        |
|                   | distressed when   | Exercise          |
|                   | unable to         |                   |
|                   | exercise == 'YES' |                   |
+-------------------+-------------------+-------------------+
| Current           | Compulsive        | Compulsive        |
| Compulsive        | Exercise          | Exercise          |
| Exercise          |                   |                   |
|                   | Do you currently  |                   |
|                   | exercise to       |                   |
|                   | control weight    |                   |
|                   | and shape AND     |                   |
|                   | feel compelled to |                   |
|                   | exercise or       |                   |
|                   | distress if       |                   |
|                   | unable to         |                   |
|                   | exercise? ==      |                   |
|                   | 'YES'             |                   |
+-------------------+-------------------+-------------------+
| Addictive         | Regular           | Exercise for      |
| Exercise          | Compulsive        | Weight Control    |
|                   | Exercise lasting  |                   |
|                   | at Least 3 month  | Regular Exercise  |
|                   |                   | for Weight        |
|                   | 1 or more of the  | Control           |
|                   | following: caused |                   |
|                   | them to change    | Compulsive        |
|                   | eating habits     | Exercise          |
|                   |                   |                   |
|                   | -decline          | Regular           |
|                   | opportunities to  | Compulsive        |
|                   | be with friends   | Exercise          |
|                   |                   |                   |
|                   | -exercised        |                   |
|                   | despite illness   |                   |
|                   | or injury         |                   |
+-------------------+-------------------+-------------------+
| Excessive         | Compulsive        | Exercise for      |
| Exercise          | Exercise          | Weight Control    |
|                   |                   |                   |
|                   | Duration \>= 1    | Compulsive        |
|                   | month             | Exercise          |
|                   |                   |                   |
|                   | Frequency =       |                   |
|                   | 'Every Day' or    |                   |
|                   | 'Nearly Every     |                   |
|                   | Day'              |                   |
+-------------------+-------------------+-------------------+
| Compensatory      | Have you ever     | NA                |
| Exercise          | used any of the   |                   |
|                   | following to      |                   |
|                   | compensate for    |                   |
|                   | episodes of binge |                   |
|                   | eating or         |                   |
|                   | overeating? (Mark |                   |
|                   | all that apply)   |                   |
|                   | (choice=Exercised |                   |
|                   | excessively       |                   |
|                   | (e.g., felt       |                   |
|                   | compelled to      |                   |
|                   | exercise, felt    |                   |
|                   | uneasy or         |                   |
|                   | distressed if     |                   |
|                   | unable to         |                   |
|                   | exercise))        |                   |
+-------------------+-------------------+-------------------+
| Maladaptive       | Compulsive        | NA                |
| Exercise          | Exercise == 'Yes' |                   |
|                   | OR Compensatory   |                   |
|                   | Exercise == 'Yes' |                   |
+-------------------+-------------------+-------------------+

: Table 1. Algorithm defining exercise-related constructs in the ED100k

# Aim 1. Evaluate patterns of response across multiple exercise constructs, to identify the degree to which these constructs overlap in membership or capture distinct groups

We hypothesize that those indicating that they have 'exercise excessively' more often in the initial screening item will also be likely to meet criteria for compulsive exercise, exercise addiction, and excessive exercise (high sensitivity), and moderately likely to meet criteria for compensatory exercise (moderate sensitivity; high negative predictive value). Specficially, we hypotehsize ensitivity for compulsive exercise, exercise addiction, and excessive exercise based on item 1 will be > 80%. Sensitivity for compensatory exercise from item 1 will be > 60%, with > 80% negative predictive value.


@fig-heatmap presents the proportion of the full sample along with subsamples meeting criteria for each (sub)construct

![Figure 1. Heatmap with percentage of (sub)samples (horizontal axis)
meeting criteria for each (sub)construct (vertical
axis).](ex_heatmap.png){#fig-heatmap}

## Sensitivity of Q1 - 'Excessive Exercise' for Weight Control

```{r}
#makes 3 month duration statistic for inclusion in paragrph below
regular_exercisers <- regular_exercisers %>% 
  mutate(ex_dur_3m = case_when(ED100k_ex_dur > 2 ~ 1,
                               ED100k_ex_dur <= 2 ~ 0))
```


```{r}
#| label: fig-Q1sensitivity
#| fig-cap: Accuracy of Q1 in Detecting Compulsive, Addictive, and Excessive Exercise

Any.Addictive <- caret::confusionMatrix(as.factor(EDGI_exercise_cleaned$ED100k_ex_any), as.factor(EDGI_exercise_cleaned$ED100k_ex_addictive), positive = '1')

Any.Compulsive <- caret::confusionMatrix(as.factor(EDGI_exercise_cleaned$ED100k_ex_any), as.factor(EDGI_exercise_cleaned$ED100k_ex_compulsive), positive = '1')

Any.Excessive <- caret::confusionMatrix(as.factor(EDGI_exercise_cleaned$ED100k_ex_any), as.factor(EDGI_exercise_cleaned$ED100k_ex_excessive), positive = '1')

Any.Compensatory <- caret::confusionMatrix(as.factor(EDGI_exercise_cleaned$ED100k_ex_any), as.factor(EDGI_exercise_cleaned$ED100k_ex_compensatory), positive = '1')

EDGI_exercise_cleaned <-  EDGI_exercise_cleaned %>% 
mutate (ED100k_exercise_regular = case_when(ED100k_exercise_icb == 2~ 1,
                                            ED100k_exercise_icb < 2 ~ 0))

Regular.Addictive <- caret::confusionMatrix(as.factor(EDGI_exercise_cleaned$ED100k_exercise_regular), as.factor(EDGI_exercise_cleaned$ED100k_ex_addictive), positive = '1')

Regular.Compulsive <- caret::confusionMatrix(as.factor(EDGI_exercise_cleaned$ED100k_exercise_regular), as.factor(EDGI_exercise_cleaned$ED100k_ex_compulsive), positive = '1')

Regular.Excessive <- caret::confusionMatrix(as.factor(EDGI_exercise_cleaned$ED100k_exercise_regular), as.factor(EDGI_exercise_cleaned$ED100k_ex_excessive), positive = '1')

Regular.Compensatory <- caret::confusionMatrix(as.factor(EDGI_exercise_cleaned$ED100k_exercise_regular), as.factor(EDGI_exercise_cleaned$ED100k_ex_compensatory), positive = '1')


# List of objects containing confusion matrix output
confusion_matrices_list <- list(Any.Addictive, Any.Compulsive, Any.Excessive, Any.Compensatory, Regular.Addictive, Regular.Compulsive, Regular.Excessive, Regular.Compensatory)

# Vector to store PPV values
sensitivity_values <- numeric(length(confusion_matrices_list))
specificity_values <- numeric(length(confusion_matrices_list))
accuracy_values <- numeric(length(confusion_matrices_list))
ppv_values <- numeric(length(confusion_matrices_list))
npv_values <- numeric(length(confusion_matrices_list))

# Character vector to store object names
object_names <- character(length(confusion_matrices_list))

# Assign custom names to the objects in the list
names(confusion_matrices_list) <- c('Any.Addictive', 'Any.Compulsive', 'Any.Excessive', 'Any.Compensate', 'Regular.Addictive', 'Regular.Compulsive', 'Regular.Excessive', 'Regular.Compensate')

# Extract PPV values and object names
for (i in 1:length(confusion_matrices_list)) {
  sensitivity_values[i] <- confusion_matrices_list[[i]]$byClass[1]
  specificity_values[i] <- confusion_matrices_list[[i]]$byClass[2]
  ppv_values[i] <- confusion_matrices_list[[i]]$byClass[3]
  npv_values[i] <- confusion_matrices_list[[i]]$byClass[4]
  accuracy_values[i] <- confusion_matrices_list[[i]]$overall[1]
  object_names[i] <- names(confusion_matrices_list)[i]
}

confusion_table <- data.frame(Object = object_names, sensitivity = sensitivity_values, specificity = specificity_values, ppv = ppv_values, npv = npv_values, accuracy= accuracy_values)

confusion_table$`Q1 Criteria` <- sapply(strsplit(as.character(confusion_table$Object), ".", fixed = TRUE), "[[", 1)
confusion_table$`Exercise Type` <- sapply(strsplit(as.character(confusion_table$Object), ".", fixed = TRUE), "[[", 2)

confusion_table <- confusion_table %>% 
  select(-c(Object))


confusion_table <- cbind(confusion_table[, c(6, 7)], confusion_table[, -c(6, 7)]) #Move variable names to columns 1-2

# Round to two decimals
confusion_table[] <- lapply(confusion_table, function(x) if(is.numeric(x)) round(x, 3) else x)
confusion_table$`Q1 Criteria` <- recode(confusion_table$`Q1 Criteria`, Regular = 'More Often') 
confusion_table <- confusion_table %>% arrange(`Exercise Type`)
confusion_table_long <- pivot_longer(confusion_table, !c(`Q1 Criteria`, `Exercise Type`), names_to = 'metric', values_to = 'value')

ggplot(confusion_table_long, aes(x = `metric`, y = value, fill = `metric`)) +
  geom_col(position = 'dodge')+
  facet_grid(`Exercise Type` ~ `Q1 Criteria`) +
  labs(title = 'Confusion Matrix Componenets by Answer to Q1', x = 'Metric', y = 'Value') + 
    theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
    theme(legend.position = 'none') +
    geom_text(aes(x  = metric, y = (value)-.1, label = paste0(round(value,3)), size = 3)) + 
   scale_fill_manual(values = wes_palette("Moonrise3")) 


```

Overall, there was high convergent validity for Q1 with Q2-Q6. Specifically, individuals eating disorders who endorse using exercise to intentionally control weight 'more often' are indeed highly likely to engage in this behavior for a substantive period of time -- `r frq(regular_exercisers$ex_dur_3m)[[1]]$valid.prc[[2]]`% of those reporting exercise to intentionally control weight 'more often' reported a duration of compulsive exercise \> 3 months; a time period of equivalent to diagnostic levels of other intentional weight control behaviors), and to report symptoms consistent with a definition of both compulsive and addictive exercise. @fig-Q1sensitivity reports on the utility of Q1 to capture different exercise constructs assessed in Q2-Q12. The sensitivity and negative predictive values of endorsement of any exercise Q1 in detecting compulsive, addictive, and excessive exercise were forced to 1.0 for those answering that they had ever engaged in any exercise on Q1 by skip logic. Sensitivity to compensatory exercise, was also high -- almost all of those who endorsed compensatory exercise also reported excessive exercise for weight loss on Q1.  Positive predictive value -- the degree to which an affirmative answer to Q1 translated to endorsement of these constructs, varied across constructs. For compulsive exercise, those who endorsed any exercise on Q1 were also very likely to endorse compulsive exercise symptoms. Positive predictive value of those endorsing any exercise on Q1 was somewhat lower for excessive and addictive exercise (.70), and even lower fro compensatory exercise (0.58) The positive predictive value rose for these three maladaptive exercise constructs when individuals reported exercise 'more often'. Regarding specificity, there was relatively high specificity for 'Any' or more to Q1 for compulsive exercise, which rose to near perfect specificity when the criteria was set at 'More Often'. Specificty was low for 'Any' exercise in Q1 capturing addictive and excessive exercise, but rose significantly when criteria was set at 'More Often'. Specificity was also low for 'Any' exercise in Q1 capturing compensatory exercise, and rose modestly when the Q1 criteria was set to 'More Often' When considering overall accuracy, endorsement of 'any' exercise in Q1 best captured those who endorsed any history of compulsive exercise, whereas, for the more stringent criteria of regular compulsive or addictive exercise, endorsement of exercise 'More Often' in Q1 demonstrated good accuracy. Overall, the vast majority of individuals with eating disorders who reporting regular exercise for weight loss to control weight and shape in Q1 go on to report that this exercise was compulsive, and that they also experienced life interfering sequellae of this behavior. Further, regarding specific addictive exercise symptoms, the modal number of exercise interference items was all 3. While Q1 accurately defined those experiencing compulsive and addictive exercise with little additional information provided from follow-up questions, the same was not true for excessive exercise and compensatory exercise -- additional questions may be necessary to define excessive and compensatory exercise with the highest levels of accuracy, and endorsement of these constructs do not entirely overlap with endorsement of other maladpative exercise symptoms.


# **Aim 2. Evaluate Convergent and Discriminant Validity between history of *maladaptive* and c*ompulsive* exercise and: current compulsive exercise, perfectionism, and OCD sympotms**

H2a: Individuals who do not report *any* *history* of maladaptive and
compulsive exercise will not report current compulsive exercise (high
negative predictive value). *\>90% negative predictive value of history
to 1. Current compulsive exercise on the EDEQ, 2. Current compulsive
exercise on the CET*

H2b: Comparing those with and without history of compulsive exercise,
those with history of compulsive exercise will report higher current
compulsive exercise symptoms (all CET subscales) than those without.
Those reporting current compulsive exercise will report the highest CET
scores. *ANOVA comparing those with no compulsive exercise, history of
compulsive exercise only, and current compulsive exercise on current
CET, p \< .05 for all subscales and global[,]{.underline} and
calculation of Cohen's d effect sizes.*

## Current Exercise

```{r}
# Insert ggplots here showing association between current exercise (ED100k), CET total and subscale scores *mean + SD, CET clinical cutoff, and EDEQ item

Current_Exercise <- EDGI_exercise_cleaned |> 
  select(record_id, cet_total_weighted_sum, cet_mood, cet_enjoy, cet_avoid, cet_rigid, cet_wtcontrol, cet_clinical, edeq_ex_driven_freq_28, ED100k_exercise_current)  |>  filter(!is.na(ED100k_exercise_current)) |> 
  mutate(cet_total_std = scale(cet_total_weighted_sum),
         cet_mood_std = scale(cet_mood),
         cet_enjoy_std = scale(cet_enjoy), 
         cet_avoid_std = scale (cet_avoid), 
         cet_rigid_std = scale (cet_rigid),
         cet_wtcontrol_std = scale(cet_wtcontrol))

  # standardize outcome variables
Current_Exercise <- Current_Exercise |> pivot_longer(cols = c(cet_total_std:cet_wtcontrol_std), names_to = 'variable', values_to = 'val') # pivot longer with current exercise as one column, variable name as second column, value as third
  # rename current maladaptive exercise 
  

median_stds <- Current_Exercise |> 
  group_by (ED100k_exercise_current, variable) |> 
  summarize (med_val = median(val, na.rm = TRUE))

cet_total_plot <- ggplot(Current_Exercise, aes(x = as.factor(ED100k_exercise_current), y = val, color = as.factor(ED100k_exercise_current))) +
  facet_wrap(~variable)+
  geom_jitter(size = 0.3) +
  geom_boxplot(alpha = 0.5, color= 'black') +
  scale_x_discrete(labels = c('No Hx', 'Hx only', 'Current')) +
  labs(title = 'Median CET standardized scores based on Driven Exercise History (ED100k)', x = 'Current Driven Exercise [ED100k]', y = 'CET Standardized Score') + 
  theme(legend.position = 'none') +
  geom_text(data = median_stds, aes(x = as.factor(ED100k_exercise_current), y = med_val + 0.3, label = round(med_val, 1)), size = 3, color = 'black', fontface ='bold')


cet_total_plot

```

## Proportion meeting CET Clinical Cutoff based on Maladaptive Exercise History

```{r}

ct3 <- table(EDGI_exercise_cleaned$ED100k_exercise_current, EDGI_exercise_cleaned$cet_clinical)
ex_current_cet <- prop.table (ct3, 1)
ex_current_cet <- as.data.frame(ex_current_cet) |> 
 rename(`Current Driven Exercise [ED100k]` = Var1) |> 
 rename(`CET Clinical Met` = Var2)   |> 
 filter (`CET Clinical Met` == 1)

ggplot(ex_current_cet, aes( x = `Current Driven Exercise [ED100k]`, y = Freq*100, fill = `Current Driven Exercise [ED100k]` )) + 
  geom_col()+
  labs(title = 'ED100k Drive Exercise vs Clinical CET Cutoff', x = 'Driven Exercise Endorsed [ED100k]', y = 'Percent Meeting CET Cutoff') + 
  scale_x_discrete(labels = c('No History', 'History, Not Current', 'Current')) +
  theme(legend.position = 'none') +
  geom_text(aes(x  = `Current Driven Exercise [ED100k]`, y = (Freq*100)-3, label = paste0(round(Freq*100,2),'%'), size = 3))
# change colour
```

### Sensitivity and Specificity of Current Driven Exercise on ED100k for CET Clinical

```{r}
EDGI_exercise_cleaned$ED100k_exercise_current_d <- as.factor(if_else(EDGI_exercise_cleaned$ED100k_exercise_current == 2, 1, 0))

EDGI_exercise_cleaned$cet_clinical <- as.factor(EDGI_exercise_cleaned$cet_clinical)

confusionMatrix(EDGI_exercise_cleaned$ED100k_exercise_current_d, EDGI_exercise_cleaned$cet_clinical, positive = '1') #confusion matrix with ED100k exercise current as prediction and CET clinical as actual

```

## Number of Days in the Past 28 reported Driven Exercise based on Driven Exercise History

```{r}

mean_edeq_ex <- EDGI_exercise_cleaned|> 
  group_by (ED100k_exercise_current) |> 
  filter(!is.na(ED100k_exercise_current)) |> 
  summarize (mean_edeq_ex = mean(edeq_ex_driven_freq_28, na.rm = TRUE))

ggplot(mean_edeq_ex, aes( x = as.factor(ED100k_exercise_current), y = mean_edeq_ex))  +
  geom_point()+
  geom_boxplot(data = EDGI_exercise_cleaned, aes( x = as.factor(ED100k_exercise_current), y = edeq_ex_driven_freq_28, fill = as.factor(ED100k_exercise_current))) +
  labs(title = 'ED100k Drive Exercise vs EDEQ Driven Exercise Frequency (Past 28 days)', x = 'Driven Exercise Endorsed [ED100k]', y = 'Number of Driven Exercise Episodes in Past 28 days [EDEQ]') + 
  scale_x_discrete(labels = c('No History', 'History, Not Current', 'Current')) +
  theme(legend.position = 'none') +
  geom_text(data = mean_edeq_ex, aes(x  = ED100k_exercise_current+1.2, y = mean_edeq_ex+3, label = paste0('M =', round(mean_edeq_ex,2)), size = 3))
```

## Perfectionism and OCD Symptoms

H2c: Within diagnostic groups - those with vs. without history of
maladaptive exercise will report higher Frost MPS and OCD symptoms.
*t-tests within diagnostic groups comparing frost MPS and OCI-R/OCI-12
subscale scores, p \< 0.05, and calculation of Cohen's d effect sizes*

H2d: Associations with the MPS and OCD measure will be weaker than with
the CET. *Interpret patterns of ES*

t-tests within diagnostic groups comparing frost MPS and OCI-R/OCI-12
subscale scores, p \< 0.05[, and calculation of Cohen's d effect
sizes]{.underline}

# Aim 3. Demonstrate Prevalence of Maladaptive (Broad), Compulsive, Addictive, Excessive, and Compensatory Exercise across Diagnostic Groups

H3a. Maladaptive exercise, compulsive exercise, and exercise addiction
will be a common symptom across diagnoses. More common in AN and BN than
BED. *Rates of maladaptive exercise, compulsive exercise, excessive
exercise, and exercise addiction will all be \> 50% in AN and BN
presentations; \> 20% in BED*

H3b. Compensatory exercise will be more common among those with AN mixed
and BN as compared to AN only . *Multinomial* *logistic regression with
AN group as reference -- BN groups will not differ but BED will? (or
some other way to use dummy coding to compare groups )*

```{r, Diagnostic-Groups, results = 'hide'}
# Below makes the 5 case status diagnosis groups

DG_prop_table <- as.data.frame(table(EDGI_exercise_cleaned[c('an_case', 'bn_case', 'bed_case')])) |>
  mutate (prop = round(Freq/sum(Freq)*100, 2)) |> 
  filter (Freq != 0) 

#Make case hierarchy and recode restrictive and binge spectrum mixed cases
EDGI_exercise_cleaned <- EDGI_exercise_cleaned |> 
  mutate (case_status = case_when(an_case == 1 & bn_case == 0 & bed_case == 0 ~ 'AN',
                                   an_case == 0 & bn_case == 1 & bed_case == 0 ~ 'BN',
                                   an_case == 0 & bn_case == 0 & bed_case == 1 ~ 'BED', 
                                   an_case == 1 & (bn_case == 1 | bed_case == 1) ~ 'AN Mixed',
                                   an_case == 0 & bn_case ==1 & bed_case ==1 ~ 'BN-BED Mixed' )) |> 
  mutate (case_heirarchy = case_when (an_case == 1 ~ 'AN', 
                                      bn_case == 1 ~ 'BN', 
                                      bed_case == 1 ~ 'BED'))
```

```{r}
ct <- table(EDGI_exercise_cleaned$case_status, EDGI_exercise_cleaned$ED100k_ex_compulsive)
ct2 <- table(EDGI_exercise_cleaned$case_status, EDGI_exercise_cleaned$ED100k_ex_compulsive_strict_3mo)
ct3 <- table(EDGI_exercise_cleaned$case_status, EDGI_exercise_cleaned$ED100k_ex_addictive)
ct4 <- table(EDGI_exercise_cleaned$case_status, EDGI_exercise_cleaned$ED100k_ex_excessive)
ct5 <- table(EDGI_exercise_cleaned$case_status, EDGI_exercise_cleaned$ED100k_ex_compensatory)

dx_row_percents_1 <- as.data.frame(prop.table (ct, 1)) |> 
  filter (Var2 == 1) |> 
  select(c(1,3)) |> 
  rename(Compulsive = Freq)
dx_row_percents_2 <- as.data.frame(prop.table (ct2, 1)) |> 
  filter (Var2 == 1) |> 
  select(c(1,3)) |> 
  rename(`Regular Compulsive` = Freq)
dx_row_percents_3 <- as.data.frame(prop.table (ct3, 1)) |> 
  filter (Var2 == 1) |> 
  select(c(1,3)) |> 
  rename(`Addictive` = Freq)
dx_row_percents_4 <- as.data.frame(prop.table (ct4, 1)) |> 
  filter (Var2 == 1) |> 
  select(c(1,3)) |> 
  rename(`Excessive` = Freq)
dx_row_percents_5 <- as.data.frame(prop.table (ct5, 1)) |> 
  filter (Var2 == 1) |> 
  select(c(1,3)) |> 
  rename(`Compensatory` = Freq)

dx_row_percents <- full_join(dx_row_percents_1, dx_row_percents_2) 
dx_row_percents <- full_join(dx_row_percents, dx_row_percents_3) 
dx_row_percents <- full_join(dx_row_percents, dx_row_percents_4) 
dx_row_percents <- full_join(dx_row_percents, dx_row_percents_5)|> 
  rename(`Diagnosis Group` = Var1) 



dx_row_percents <- pivot_longer(dx_row_percents, cols =  c('Compulsive', 'Regular Compulsive', 'Addictive', 'Excessive', 'Compensatory') )

ggplot(dx_row_percents, aes(x = name, y = value*100, fill = `name` )) +
  geom_col()+
  facet_wrap (~ `Diagnosis Group`) +
  labs(title = 'Percentages by Diagnosis Group and Exercise Group', x = 'Exercise Group', y = 'Percentage (within Diagnosis Group)') + 
    theme(axis.text.x = element_text(angle = 45, vjust = 1, hjust=1)) +
    theme(legend.position = 'none') +
    geom_text(aes(x  = name, y = (value*100)-5, label = paste0(round(value*100,0),'%'), size = 3))

```

History of Compulsive Exercise was reported most frequently in the AN,
AN-Mixed Diagnosis, and BN groups, around 60% in each of these
diagnostic groups reporting history of regular engagment. Compulsive
exercise was also reported in half of those with BN-BED (50%) and a
portion (20%) of those with BED.
